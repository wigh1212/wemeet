<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.zerock.mapper.SellBoardMapper">

<!-- 메인 홈 로딩  -->
<select id="getlist" resultType="org.zerock.domain.SellboardVO">
<![CDATA[
select * from selboard WHERE rownum<7 ORDER BY sregdate ASC 
]]>
</select>

<select id="topstream" resultType="org.zerock.domain.SellboardVO">
	<![CDATA[
	select * from selboard where rownum< 7 AND sstream IS NOT NULL ORDER BY sregdate ASC
	]]>
</select>

<select id="topstream1" resultType="org.zerock.domain.SellboardVO">
	<![CDATA[
	select * from selboard where rownum< 7 AND rownum > 3 AND sstream IS NOT NULL ORDER BY sregdate ASC
	]]>
</select>


<select id=""></select>

<select id="topsell" resultType="org.zerock.domain.SellboardVO">
	<![CDATA[
	select * from selboard where  rownum < 7 ORDER BY  views ASC
	]]>
</select>




<!-- 판매글 쓰기 -->
<insert id="insert">
	insert into SELBOARD (SNO,MID,SNAME,SCATEGORY,SREGDATE,SCONTENTSSTHUMB,SSIMAGE,SMONEY,SADDRESS,SPHONE )
values (sno_sequence.nextval,#{mid}, #{sname},#{scategory},sysdate,#{scontent},#{ssthumb},#{ssimage},#{smoney},#{SADDRESS},#{SPHONE})
</insert>

<!-- 판매글 링크 클릭시 -->
<select id="read" resultType="org.zerock.domain.SellboardVO">
	select * from selboard where sno=#{sno}
</select>

<!-- 판매글 삭제 -->
<delete id="delete">
	delete from SELBOARD,SELQNA,SELREVIEW,SQCOMMENT where sno=#{sno} 
</delete>

<!-- 판매글 수정 -->
<update id="update">
	update SELBOARD SNAME=#{sname},SCATEGORY=#{scategory},SSTARTDATE=#{sstartdate},SENDDATE=#{senddate},SSCHEDULE=#{sschedule} ,SCONTENT=#{scontent}, SCOMMENT=#{scomment},STARGET=#{starget},SCLAIM=#{sclaim},SSTHUMB=#{ssthumb},SSIMAGE=#{ssimage},SURL=#{surl},SSTREAM=#{sstream},SMONEY=#{smoney},SMOC=#{smoc},SMOCIN=#{smocin}
	where sno=#{sno}
</update>



  <select id="search" resultType="org.zerock.domain.SellboardVO">
   <![CDATA[
   select *
     from (select /*+INDEX_DESC(selboard pk_selboard) */ rownum rn , sname
      from selboard
      where 
   ]]>
   
   <include refid="criteria"></include>
   
<![CDATA[
   rownum <= #{pageNum} * #{amount}                                                                                                     
   )
  where rn > (#{pageNum} -1 ) * #{amount}   
]]>
</select>



<sql id="criteria">
   <trim prefix="(" suffix=") AND" prefixOverrides="OR">
      <foreach item='type' collection="typeArr">
         <trim prefix="OR">
            <choose>
               <when test="type == 'T'.toString()">
                  sname like '%'||#{keyword}||'%'
              </when>
          </choose>
       </trim>
      </foreach>
    </trim>
 </sql>

</mapper>